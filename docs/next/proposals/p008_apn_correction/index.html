<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>MME APN Correction · Magma Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Overview"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="MME APN Correction · Magma Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://magma.github.io/magma/"/><meta property="og:description" content="# Overview"/><meta property="og:image" content="https://magma.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://magma.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/magma-logo.svg" alt="Magma Documentation"/><h2 class="headerTitleWithLogo">Magma Documentation</h2></a><a href="/magma/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://magmacore.org" target="_self">Home</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="/" target="_self">Docs</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma" target="_self">Code</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://magmacore.org/community" target="_self">Community</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h1>
<p><em>Status: Accepted</em><br>
<em>Author: @ymasmoudi</em><br>
<em>Last Updated: 09/22</em></p>
<p>During session establishment, the phone may have an APN configured already.
In this case, this APN will be used as it has a higher precedence over the
one provided by the SIM card.</p>
<p>This feature enables the overriding of UE requested APN with a network
specified APN via IMSI prefix based filtering. Up to 10 IMSI prefix filters
and corresponding APNs to overwrite with can be defined.</p>
<p>Note that the APN correction applies to a federated set up only where HSS
is used.</p>
<h2><a class="anchor" aria-hidden="true" id="proposition"></a><a href="#proposition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Proposition</h2>
<p>The PDN connectivity procedure is used by the UE to request the setup of a
default EPS bearer to a PDN by sending a PDN Connectivity Request message to
the network.</p>
<p>During this phase, the UE may communicate its APN following one of 3 modes:</p>
<p>1/ The UE may set the ESM information transfer flag in the PDN Connectivity
Request to indicate that it has ESM information that needs to be transferred
to the MME after the NAS signalling security has been activated.
In this case, the network initiates the ESM information request procedure in
which the UE can provide the MME with APN.</p>
<p>2/ The UE shall include the requested APN in the standalone PDN Connectivity
Request when requesting connectivity to an additional PDN.</p>
<p>3/ If no APN is included in the ESM Information Response or PDN Connectivity
Request message, then the UE is connected to the default APN.</p>
<p>The APN correction, if enabled by setting enable_apn_correction to true, will
overwrite the APN requested by UE for UEs with matching imsi_prefix filter
specified as part of apn_correction_map_list with the value of key apn_override.</p>
<pre><code class="hljs">cat <span class="hljs-regexp">/etc/</span>magma/mme.yml
....
<span class="hljs-string">enable_apn_correction:</span> <span class="hljs-literal">false</span>
<span class="hljs-string">apn_correction_map_list:</span>
        - <span class="hljs-string">imsi_prefix:</span> <span class="hljs-string">"00101"</span>
<span class="hljs-symbol">          apn_override:</span> <span class="hljs-string">"magma.ipv4"</span>
</code></pre>
<p>The configuration will be limited to a maximum of 10 imsi prefix filters.</p>
<h2><a class="anchor" aria-hidden="true" id="how-we-will-change-magma"></a><a href="#how-we-will-change-magma" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How We Will Change Magma</h2>
<p><strong>MME Change</strong></p>
<p>Two structures will be added to contain the mme apn correction configuration</p>
<p>typedef struct apn_map_s {
bstring imsi_prefix;
bstring apn_override;
} apn_map_t;</p>
<p>typedef struct apn_map_config_s {
int nb;
apn_map_t apn_map[MAX_APN_CORRECTION_MAP_LIST];
} apn_map_config_t;</p>
<p>In addition, a new function will be introduced to filter and return the overridden
APN based on the MME NAS config.</p>
<p>This function will be called upon reception of the ESM Information Request or PDN
Connectivity Request.</p>
<p>Mconfig proto description will be changed to support APN correction configuration
pending the support of mme config in swagger and NMS.</p>
<p><strong>ORC8R Change</strong></p>
<p>Exposing MME configuration to swagger will be supported in a later phase.</p>
<p><strong>NMS Change</strong></p>
<p>Exposing APN correction configuration to NMS will be supported in a later phase.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#proposition">Proposition</a></li><li><a href="#how-we-will-change-magma">How We Will Change Magma</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/magma/" class="nav-home"><img src="/magma/img/magma_icon.png" alt="Magma Documentation" width="66"/></a><div><h5>Docs</h5><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Product_Overview.pdf">Magma Product Overview</a><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Specs_V1.1.pdf">Magma Spec</a></div><div><h5>Community</h5><a href="https://discord.gg/4YxZbft">Discord</a><a href="https://fb.me/magmadevsummit" target="_blank" rel="noreferrer noopener">Magma Dev Summit</a></div><div><h5>More</h5><a href="https://code.fb.com/open-source/magma/">Blog</a><a href="https://github.com/facebookincubator/magma">GitHub</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/magma/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 The Magma Authors</section></footer></div></body></html>