<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>lte/sessiond · Magma</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Session Management in Magma"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="lte/sessiond · Magma"/><meta property="og:type" content="website"/><meta property="og:url" content="https://magma.github.io/magma/"/><meta property="og:description" content="# Session Management in Magma"/><meta property="og:image" content="https://magma.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://magma.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/fb.png" alt="Magma"/><h2 class="headerTitleWithLogo">Magma</h2></a><a href="/magma/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/magma/docs/next/basics/introduction" target="_self">Docs</a></li><li class=""><a href="/magma/help" target="_self">Help</a></li><li class=""><a href="https://github.com/magma/magma" target="_self">Github</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">lte/sessiond</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="session-management-in-magma"></a><a href="#session-management-in-magma" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Session Management in Magma</h1>
<h2><a class="anchor" aria-hidden="true" id="overview-of-sessiond"></a><a href="#overview-of-sessiond" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview of SessionD</h2>
<p>SessionD is the main service responsible for managing and enforcing session
configurations.</p>
<h3><a class="anchor" aria-hidden="true" id="interfaces"></a><a href="#interfaces" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Interfaces</h3>
<p>SessionD interfaces with three distinct external components.</p>
<ol>
<li>Access (MME, AAA) <br>
This component receives all connection and session related information from
the UE. It also handles mobility management. But from SessionD's point of view,
it notifies SessionD whenever a UE is attached or detached. This notification
will include any context that SessionD needs for enforcement.</li>
<li>Policy (PolicyDB, FeG+PCRF/OCS) <br>
This component is responsible for propagating any session or policy
configuration that SessionD must enforce. Whenever a new UE is introduced,
SessionD will reach out to this component to fetch any configuration. Depending
on the configuration, SessionD maybe reach out to this component for updates.</li>
<li>User Plane (PipelineD) <br>
This component is responsible for policy and QoS enforcement. It receives
any relevant policy and QoS configuration from SessionD and periodically
reports usage accordingly.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="internal-architecture"></a><a href="#internal-architecture" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Internal Architecture</h3>
<p><img src="SessionD_Architecture.png" alt="Internal Architecture Diagram"></p>
<h2><a class="anchor" aria-hidden="true" id="configurations-not-exhaustive"></a><a href="#configurations-not-exhaustive" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configurations (Not Exhaustive)</h2>
<ul>
<li>FeG Relay <br>
A federation gateway, FeG, is an entity responsible for hosting a centralized
control plane interface towards an operator core. In terms of session
management, the SessionProxy service on a FeG will relay all session related
interactions. <br>
This feature can be enabled on the Orc8r with a network wide <code>relay_enabled</code>
flag. When it is disabled, a local PolicyDB service is used in place. This
service will directly fetch session configurations from the Orc8r. <br>
The feature is disabled by default.</li>
<li>Omnipresent Rules <br>
<em>This feature is currently only relevant for the federated case.</em> <br>
Omnipresent rules are policies that are applied to all subscribers in a
network. The list of such policies are configured on the Orc8r as a network
configuration and are streamed down to all gateways in the network.
These policies are added onto the list of policies configured by the PCRF.</li>
<li>Zero Wallet Detections <br>
<em>This feature is currently only relevant for the CWF case.</em> <br>
This configures a way for SessionD to detect when a subscriber is out of valid
wallet. When an empty wallet is detected, the empty status is propagated to
PipelineD, which hosts a flask server that indicates the state. After a
configured number of seconds, the session will be terminated and the user will
be kicked out.
The configuration is done in Orc8r, but it is not currently exposed by an API.
This timeout is configured in <code>sessiond.yml</code> with
<code>cwf_quota_exhaustion_termination_on_init_ms</code>.
<br>
The detection methods are described below: <br>
<ul>
<li>GxTrackedRules: Wallet is empty if there are no active PCRF tracked policy.
PCRF tracked policies are policies with tracking type <code>PCRF_ONLY</code> or
<code>PCRF_AND_OCS</code>.</li>
</ul></li>
<li><code>magma/lte/gateway/configs/sessiond.yml</code> has more configurations that are
managed on each gateway.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="stateless-operation"></a><a href="#stateless-operation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stateless Operation</h2>
<p>A stateless SessionD service can be enabled by the <code>support_stateless</code> flag in
<code>sessiond.yml</code>. This feature allows SessionD to be restarted without requiring
previously existing sessions to be re-authenticated.</p>
<p>With this feature, SessionD stores all session state updates into Redis for
persistent storage. When a session states needs to be modified, the state is
loaded from storage and modified in memory. When the modification is complete,
the updates are written back into Redis. When the feature is disabled, all
states are kept in memory.</p>
<p><code>SessionStore</code> is the interface to storage that makes the decision of where the
states are kept based on the <code>support_stateless</code> flag.
Updates to stored session state are done with the <code>UpdateCriteria</code> structures
passed into <code>SessionStore</code>.</p>
<p>To ensure that SessionD can always be restarted properly, session state
should always be consistent with services with which it interacts.
On SessionD restart, session state will be synced to MME service, which
it will use as the source of truth for active sessions.
Based on the active sessions, PipelineD will be instructed to
allow/disallow traffic.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview-of-sessiond">Overview of SessionD</a><ul class="toc-headings"><li><a href="#interfaces">Interfaces</a></li><li><a href="#internal-architecture">Internal Architecture</a></li></ul></li><li><a href="#configurations-not-exhaustive">Configurations (Not Exhaustive)</a></li><li><a href="#stateless-operation">Stateless Operation</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/magma/" class="nav-home"><img src="/magma/img/fb.png" alt="Magma" width="66" height="58"/></a><div><h5>Docs</h5><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Product_Overview.pdf">Magma Product Overview</a><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Specs_V1.1.pdf">Magma Spec</a></div><div><h5>Community</h5><a href="https://discord.gg/4YxZbft">Discord</a><a href="https://fb.me/magmadevsummit" target="_blank" rel="noreferrer noopener">Magma Dev Summit</a></div><div><h5>More</h5><a href="https://code.fb.com/open-source/magma/">Blog</a><a href="https://github.com/facebookincubator/magma">GitHub</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/magma/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 The Magma Authors</section></footer></div></body></html>